\
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador – Copo Cloudinary</title>
<style>
  :root{
    --gap:20px;
    --panel:280px;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,Arial;margin:24px}
  h1{margin:0 0 16px}
  .wrap{
    display:grid;
    grid-template-columns: var(--panel) 1fr;
    gap: var(--gap);
    align-items:start;
  }
  .controls{border:1px solid #e5e5e5;padding:16px;border-radius:8px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:10px 0}
  label{min-width:150px}
  input[type="text"], input[type="url"]{padding:8px;width:100%}
  input[type="range"]{width:100%}
  select{padding:8px}
  button{padding:10px 14px;cursor:pointer;border:1px solid #ddd;border-radius:6px;background:#fafafa}
  button:hover{background:#f0f0f0}
  .chip{display:inline-block;padding:4px 8px;border:1px solid #ddd;border-radius:999px;background:#fff}
  .swatch{display:inline-block;width:18px;height:18px;border:1px solid #ccc;vertical-align:middle}
  .mono{font-family:ui-monospace,Consolas,monospace;font-size:12px;word-break:break-all;background:#f7f7f7;padding:10px;border:1px solid #eee}
  .preview{border:1px solid #e5e5e5;padding:12px;border-radius:8px}
  .preview img{max-width:420px;width:100%;display:block;border:1px solid #ddd;border-radius:6px;margin-top:8px}
  .hint{color:#666;font-size:12px}
  @media (max-width: 820px){
    .wrap{grid-template-columns: 1fr}
    .preview img{max-width:100%}
  }
</style>
</head>
<body>
<h1>Gerar imagem personalizada (Cloudinary) – preview e download</h1>

<div class="wrap">
  <div class="controls">
    <div class="row"><label>Cloud name</label><input id="cloud" value="dr3r1szcw" /></div>
    <div class="row"><label>Public ID</label><input id="publicId" value="v1758136687/copo_qyzeoa.jpg" /></div>

    <div class="row"><label>Nome</label><input id="nome" placeholder="Ex.: Denis" value="Dennis" /></div>
    <div class="row"><label>Tamanho (fontsize)</label><input id="fs" type="range" min="10" max="120" value="27" /><span id="fsv" class="chip">27</span></div>
    <div class="row"><label>Posição X</label><input id="x" type="range" min="-300" max="300" value="140" /><span id="xv" class="chip">140</span></div>
    <div class="row"><label>Posição Y</label><input id="y" type="range" min="-300" max="300" value="50" /><span id="yv" class="chip">50</span></div>

    <div class="row"><label>Cor (0=cinza • 50=marrom • 100=preto)</label><input id="cor" type="range" min="0" max="100" value="35" /><span id="corv" class="chip">35</span><span id="sw" class="swatch"></span></div>
    <div class="row"><label>Opacidade</label><input id="opac" type="range" min="0" max="100" value="60" /><span id="opacv" class="chip">60</span></div>
    <div class="row"><label>Blur</label><input id="blur" type="range" min="0" max="16" value="8" /><span id="blurv" class="chip">8</span></div>

    <div class="row">
      <button id="gen">Gerar</button>
      <button id="copy">Copiar link (.jpg)</button>
      <button id="dl">Baixar JPG</button>
    </div>

    <div class="row">
      <label>Seu domínio Vercel (opcional)</label>
      <input id="ogdom" type="url" placeholder="https://SEU-PROJETO.vercel.app" />
    </div>
    <div class="row">
      <button id="copyOg">Copiar link OG (/p?n=...)</button>
    </div>
    <p class="hint">Use o link OG quando precisar de cartão/preview no inbox. Para sair só a imagem, baixe o JPG e anexe na conversa.</p>
  </div>

  <div class="preview">
    <div class="row"><strong>URL da imagem (.jpg):</strong></div>
    <pre id="out" class="mono"></pre>
    <img id="preview" alt="preview" />
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const enc = s => encodeURIComponent(s || '').replace(/%20/g,'%20');

function hex(n){ return Math.round(n).toString(16).padStart(2,'0'); }
function lerp(a,b,t){ return a + (b-a)*t; }
function lerpColor(c1,c2,t){ return [
  Math.round(lerp(c1[0],c2[0],t)),
  Math.round(lerp(c1[1],c2[1],t)),
  Math.round(lerp(c1[2],c2[2],t))
];}
function rgbToHex([r,g,b]){ return `#${hex(r)}${hex(g)}${hex(b)}`; }
function colorFromSlider(v){
  const p = Math.max(0, Math.min(100, Number(v)));
  const gray=[0x44,0x44,0x44], brown=[0x3a,0x2f,0x25], blacky=[0x1f,0x1f,0x1f];
  const t = p<=50 ? p/50 : (p-50)/50;
  const rgb = p<=50 ? lerpColor(gray,brown,t) : lerpColor(brown,blacky,t);
  return rgbToHex(rgb).replace('#','');
}

function buildCloudinaryURL(){
  const cloud=$('cloud').value.trim(), publicId=$('publicId').value.trim();
  const nome=$('nome').value.trim()||' ', fs=$('fs').value, x=$('x').value, y=$('y').value;
  const colorHex=colorFromSlider($('cor').value), opac=$('opac').value, blur=$('blur').value;

  const extras = [];
  if (colorHex) extras.push(`co_rgb:${colorHex}`);
  if (Number(opac)>0) extras.push(`o_${opac}`);
  if (Number(blur)>0) extras.push(`e_blur:${blur}`);

  // força jpg no final para download mais compatível
  const base=`https://res.cloudinary.com/${cloud}/image/upload/`;
  const ltext=`l_text:Permanent%20Marker_${fs}:${enc(nome)}` + (extras.length?`,`+extras.join(','):'');
  const apply=`fl_layer_apply,g_center,x_${x},y_${y}`;
  const url = `${base}${ltext}/${apply}/f_jpg,q_auto/${publicId}`;
  return url;
}

function refresh(){
  const url=buildCloudinaryURL();
  $('out').textContent=url;
  $('preview').src=url;

  $('fsv').textContent=$('fs').value;
  $('xv').textContent=$('x').value;
  $('yv').textContent=$('y').value;
  $('corv').textContent=$('cor').value;
  $('opacv').textContent=$('opac').value;
  $('blurv').textContent=$('blur').value;
  $('sw').style.background=`#${colorFromSlider($('cor').value)}`;
}

['cloud','publicId','nome','fs','x','y','cor','opac','blur'].forEach(id=>$(id).addEventListener('input',refresh));
$('gen').onclick=refresh;

$('copy').onclick=async()=>{
  const url=buildCloudinaryURL();
  await navigator.clipboard.writeText(url);
  alert('Link da IMAGEM (.jpg) copiado!');
};

$('dl').onclick=async()=>{
  const url=buildCloudinaryURL();
  const a=document.createElement('a');
  a.href=url;
  a.download='copo_personalizado.jpg';
  document.body.appendChild(a);
  a.click();
  a.remove();
};

$('copyOg').onclick=async()=>{
  const dom=$('ogdom').value.trim().replace(/\/+$/,'');
  if(!dom){ alert('Preencha o domínio Vercel (https://...)'); return; }
  const nome=$('nome').value.trim()||' ';
  const og=`${dom}/p?n=${enc(nome)}&fs=${$('fs').value}&x=${$('x').value}&y=${$('y').value}&co=${colorFromSlider($('cor').value)}&o=${$('opac').value}&blur=${$('blur').value}`;
  await navigator.clipboard.writeText(og);
  alert('Link OG copiado!');
};

// inicial
refresh();
</script>
</body>
</html>
