<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador – Copo Cloudinary (rápido + ajustes)</title>
<style>
  :root{--gap:10px}
  body{font-family:system-ui,Arial;margin:24px;max-width:1000px}
  h2{margin:0 0 14px}
  .row{display:flex;gap:var(--gap);align-items:center;flex-wrap:wrap}
  input[type="text"]{padding:10px 12px;font-size:16px;min-width:260px}
  button{padding:10px 14px;font-size:15px;cursor:pointer}
  .mono{font-family:ui-monospace,Consolas,monospace;font-size:12px;background:#f7f7f7;padding:8px 10px;border:1px solid #eee;margin-top:8px;word-break:break-all}
  .chip{display:inline-block;padding:4px 8px;border:1px solid #ddd;border-radius:999px;background:#fff;font-size:12px}
  .swatch{display:inline-block;width:18px;height:18px;border:1px solid #bbb;vertical-align:middle}
  .section{margin-top:18px;padding-top:10px;border-top:1px dashed #ddd}
  img{max-width:100%;border:1px solid #ddd;margin-top:10px}
  label{min-width:160px}
  input[type="range"]{width:260px}
  details{margin-top:6px}
  summary{cursor:pointer;color:#333}
</style>
</head>
<body>
<h2>Gerador rápido – 1 campo + 2 cliques</h2>

<div class="row">
  <input id="nome" placeholder="Digite o primeiro nome..." autofocus />
  <button id="copyOg">Copiar link p/ LinkedIn</button>
  <button id="download">Baixar JPG</button>
</div>

<pre id="ultimoLink" class="mono"></pre>

<div class="section">
  <details open>
    <summary><b>Ajustes (tempo real)</b> – use só quando precisar</summary>

    <div class="row" style="margin-top:10px">
      <label>Tamanho (font-size)</label>
      <input id="fs" type="range" min="10" max="120" value="27" />
      <span id="fsv" class="chip">27</span>
    </div>

    <div class="row">
      <label>Posição X</label>
      <input id="x" type="range" min="-300" max="300" value="140" />
      <span id="xv" class="chip">140</span>
    </div>

    <div class="row">
      <label>Posição Y</label>
      <input id="y" type="range" min="-300" max="300" value="50" />
      <span id="yv" class="chip">50</span>
    </div>

    <div class="row">
      <label>Cor (0=cinza • 50=marrom • 100=preto)</label>
      <input id="cor" type="range" min="0" max="100" value="35" />
      <span id="corv" class="chip">35</span>
      <span id="sw" class="swatch"></span>
    </div>

    <div class="row">
      <label>Opacidade</label>
      <input id="opac" type="range" min="0" max="100" value="65" />
      <span id="opacv" class="chip">65</span>
    </div>

    <div class="row">
      <label>Blur</label>
      <input id="blur" type="range" min="0" max="16" value="8" />
      <span id="blurv" class="chip">8</span>
    </div>

    <div class="row">
      <button id="copyOg2">Copiar link p/ LinkedIn (com ajustes)</button>
      <button id="download2">Baixar JPG (com ajustes)</button>
    </div>

    <p><b>Preview em tempo real:</b></p>
    <img id="preview" alt="preview" />
  </details>
</div>

<script>
  // ==== CONFIG BASE ====
  const CLOUD    = 'dr3r1szcw';
  const PUBLICID = 'v1758136687/copo_qyzeoa.jpg';

  // defaults (podem ser trocados a qualquer momento)
  const DEF = { fs:27, x:140, y:50, co:'2b2b2b', o:65, blur:8 };

  const $ = id => document.getElementById(id);
  const enc = s => encodeURIComponent((s||'').trim());

  function hex(n){ return Math.round(n).toString(16).padStart(2,'0'); }
  function lerp(a,b,t){ return a + (b-a)*t; }
  function lerpColor(c1,c2,t){ return [
    Math.round(lerp(c1[0],c2[0],t)),
    Math.round(lerp(c1[1],c2[1],t)),
    Math.round(lerp(c1[2],c2[2],t))
  ];}
  function rgbToHex([r,g,b]){ return `#${hex(r)}${hex(g)}${hex(b)}`; }
  function colorFromSlider(v){
    const p = Math.max(0, Math.min(100, Number(v)));
    const gray=[0x44,0x44,0x44], brown=[0x3a,0x2f,0x25], blacky=[0x1f,0x1f,0x1f];
    const t = p<=50 ? p/50 : (p-50)/50;
    const rgb = p<=50 ? lerpColor(gray,brown,t) : lerpColor(brown,blacky,t);
    return rgbToHex(rgb).replace('#','');
  }

  function getParams(){
    return {
      fs: Number($('fs').value || DEF.fs),
      x:  Number($('x').value  || DEF.x),
      y:  Number($('y').value  || DEF.y),
      co: colorFromSlider($('cor').value || 35),
      o:  Number($('opac').value || DEF.o),
      blur: Number($('blur').value || DEF.blur),
    };
  }

  function buildCloudinaryURL(nome, p=getParams()){
    const base  = `https://res.cloudinary.com/${CLOUD}/image/upload/`;
    const ltxt  = `l_text:Permanent%20Marker_${p.fs}:${enc(nome)},co_rgb:${p.co}${p.o>0?`,o_${p.o}`:''}${p.blur>0?`,e_blur:${p.blur}`:''}`;
    const apply = `fl_layer_apply,g_center,x_${p.x},y_${p.y}`;
    return `${base}${ltxt}/${apply}/${PUBLICID}`;
  }

  function buildOgLink(nome, p=getParams()){
    const origin = location.origin.replace(/\/+$/,''); // domínio atual Vercel
    return `${origin}/p?n=${enc(nome)}&fs=${p.fs}&x=${p.x}&y=${p.y}&co=${p.co}&o=${p.o}&blur=${p.blur}`;
  }

  async function downloadImage(url, filename='copo.jpg'){
    const resp = await fetch(url, {mode:'cors'});
    const blob = await resp.blob();
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  }

  function refreshPreview(){
    const nome = $('nome').value || ' ';
    const p = getParams();
    const url = buildCloudinaryURL(nome, p);
    $('preview').src = url;
    $('fsv').textContent = p.fs;
    $('xv').textContent  = p.x;
    $('yv').textContent  = p.y;
    $('corv').textContent= $('cor').value;
    $('opacv').textContent= p.o;
    $('blurv').textContent= p.blur;
    $('sw').style.background = '#' + p.co;
    // também atualiza o último link mostrado (só como referência)
    $('ultimoLink').textContent = buildOgLink(nome, p);
  }

  // topo — uso em escala (nome -> copiar/baixar)
  $('copyOg').onclick = async () => {
    const nome = $('nome').value || '';
    if (!nome.trim()) { alert('Digite o nome.'); return; }
    const link = buildOgLink(nome);
    await navigator.clipboard.writeText(link);
    $('ultimoLink').textContent = link;
  };
  $('download').onclick = async () => {
    const nome = $('nome').value || '';
    if (!nome.trim()) { alert('Digite o nome.'); return; }
    const img = buildCloudinaryURL(nome);
    await downloadImage(img, `copo-${nome}.jpg`);
    $('ultimoLink').textContent = img;
  };

  // seção de ajustes — com os parâmetros atuais
  $('copyOg2').onclick = async () => {
    const nome = $('nome').value || '';
    if (!nome.trim()) { alert('Digite o nome.'); return; }
    const link = buildOgLink(nome, getParams());
    await navigator.clipboard.writeText(link);
    $('ultimoLink').textContent = link;
  };
  $('download2').onclick = async () => {
    const nome = $('nome').value || '';
    if (!nome.trim()) { alert('Digite o nome.'); return; }
    const img = buildCloudinaryURL(nome, getParams());
    await downloadImage(img, `copo-${nome}.jpg`);
    $('ultimoLink').textContent = img;
  };

  // eventos em tempo real
  ['nome','fs','x','y','cor','opac','blur'].forEach(id => {
    document.getElementById(id).addEventListener('input', refreshPreview);
  });
  // Enter = copiar link OG (rápido)
  $('nome').addEventListener('keydown', e => { if(e.key==='Enter') $('copyOg').click(); });

  // inicial
  refreshPreview();
</script>
</body>
</html>
